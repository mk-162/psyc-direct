---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";

// Get the slug from the URL
const { slug } = Astro.params;

// Fetch all posts and find the matching one
const allPosts = await getCollection("posts");
const post = allPosts.find((p) => p.slug === slug);

// If no post found, return 404
if (!post) {
  return Astro.redirect("/404");
}

const { Content } = await post.render();

const formattedDate = post.data.publishDate.toLocaleDateString("en-GB", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout
  title={post.data.seoTitle || post.data.title}
  description={post.data.metaDescription || post.data.excerpt || undefined}
>
  <article class="py-16">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <!-- Breadcrumb -->
        <nav class="mb-8 text-sm text-gray-600">
          <a href="/" class="hover:text-blue-600">Home</a>
          <span class="mx-2">/</span>
          <a href="/blog" class="hover:text-blue-600">Blog</a>
          <span class="mx-2">/</span>
          <span class="text-gray-900"
            >{post.data.seoTitle || post.data.title}</span
          >
        </nav>

        <!-- Article Header -->
        <header class="mb-8">
          {
            post.data.coverImage && (
              <div class="mb-8 rounded-lg overflow-hidden shadow-lg">
                <Image
                  src={post.data.coverImage}
                  alt={post.data.title}
                  class="w-full h-auto object-cover"
                  width={1200}
                  height={675}
                />
              </div>
            )
          }
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-4">
            <time datetime={post.data.publishDate.toISOString()}
              >{formattedDate}</time
            >
            <span>Â·</span>
            <span class="capitalize"
              >{post.data.category.replace(/-/g, " ")}</span
            >
          </div>

          <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
            {post.data.seoTitle || post.data.title}
          </h1>

          {
            post.data.excerpt && (
              <p class="text-xl text-gray-600 mb-4">{post.data.excerpt}</p>
            )
          }

          <div class="flex items-center gap-4 text-sm text-gray-600">
            <span>By {post.data.author}</span>
          </div>

          {
            post.data.tags && post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-4">
                {post.data.tags.map((tag) => (
                  <span class="inline-block bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
            )
          }
        </header>

        <!-- Article Content -->
        <div
          class="prose prose-lg max-w-none prose-headings:text-gray-900 prose-p:text-gray-700 prose-a:text-blue-600 prose-a:no-underline hover:prose-a:underline prose-strong:text-gray-900 prose-ul:text-gray-700 prose-ol:text-gray-700"
        >
          <Content />
        </div>

        <!-- Back to Blog -->
        <div class="mt-12 pt-8 border-t border-gray-200">
          <a
            href="/blog"
            class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium"
          >
            <svg
              class="w-5 h-5 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Blog
          </a>
        </div>
      </div>
    </div>
  </article>
</Layout>
