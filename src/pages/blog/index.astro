---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Layout from "../../layouts/Layout.astro";

const allPosts = await getCollection("posts");

// Filter out drafts and sort by publish date (newest first)
const publishedPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => {
    const dateA = new Date(a.data.publishDate);
    const dateB = new Date(b.data.publishDate);
    return dateB.getTime() - dateA.getTime();
  });
---

<Layout
  title="Blog - Psychology Direct"
  description="Expert insights on psychology, psychiatry, and expert witness services in legal proceedings"
>
  <section class="py-16 bg-gray-50">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Blog</h1>
        <p class="text-xl text-gray-600 mb-12">
          Expert insights and guidance on psychology and expert witness services
        </p>

        {
          publishedPosts.length === 0 ? (
            <p class="text-gray-600">No blog posts found.</p>
          ) : (
            <div class="space-y-8">
              {publishedPosts.map((post) => (
                <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                  <a href={`/blog/${post.slug}`} class="block">
                    {post.data.coverImage && (
                      <div class="aspect-video w-full overflow-hidden">
                        <Image
                          src={post.data.coverImage}
                          alt={post.data.title}
                          class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"
                          width={800}
                          height={450}
                        />
                      </div>
                    )}
                    <div class="p-6">
                      <div class="flex items-center text-sm text-gray-500 mb-2">
                        <time datetime={post.data.publishDate.toISOString()}>
                          {post.data.publishDate.toLocaleDateString("en-GB", {
                            year: "numeric",
                            month: "long",
                            day: "numeric",
                          })}
                        </time>
                        <span class="mx-2">Â·</span>
                        <span class="capitalize">
                          {post.data.category.replace(/-/g, " ")}
                        </span>
                      </div>

                      <h2 class="text-2xl font-bold text-gray-900 mb-3 hover:text-blue-600 transition-colors">
                        {post.data.seoTitle || post.data.title}
                      </h2>

                      {post.data.excerpt && (
                        <p class="text-gray-600 mb-4 line-clamp-3">
                          {post.data.excerpt}
                        </p>
                      )}

                      {post.data.tags && post.data.tags.length > 0 && (
                        <div class="flex flex-wrap gap-2">
                          {post.data.tags.map((tag) => (
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                              {tag}
                            </span>
                          ))}
                        </div>
                      )}
                    </div>
                  </a>
                </article>
              ))}
            </div>
          )
        }
      </div>
    </div>
  </section>
</Layout>
